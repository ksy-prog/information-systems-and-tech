
# Управление процессами, памятью и файловыми системами

## Структура конспекта
*   Управление процессами: выполнение программ
*   Управление памятью: организация данных в ОЗУ  
*   Файловые системы: хранение информации на дисках
*   Взаимосвязь компонентов системы

---

### ВВЕДЕНИЕ

Мы ознакомились с Операционными Системами (ОС) в компьютерной среде, разобрали их функции, назначения.
Теперь затронем про то, как ОС управляет *процессами, памятью и файловыми системами.*

> Дисклеймер: автор конспекта очень устал, и тематика этого вопроса на самом деле очень муторная и непонятная.
> Тема невероятно сложная, если копаться в ней чутка "поглубже". Поэтому пройдёмся поверхностно.

---

### УПРАВЛЕНИЕ ПРОЦЕССАМИ: ВЫПОЛНЕНИЕ ПРОГРАММ

Когда пользователь запускает программу (Word к примеру), ОС создает специальную структуру, которая называется **процесс**. 
Процесс представляет собой не просто запущенную программу, а полную среду выполнения, включающую код программы, данные и текущее состояние выполнения.
Каждому процессу присваивается уникальный идентификатор **PID**, который позволяет системе отличать один процесс от другого.

<img src="https://sun9-12.userapi.com/s/v1/ig2/PTdEtTjnfEkMHDpa-mx5ckso9XiNKDBorBukPrNwimzQNWZkYRaef_G4M_OQSRjs2KSmRLKGxaBDZs7gadqhyeB3.jpg?quality=95&as=32x20,48x30,72x45,108x68,160x100,240x150,360x225,480x300,540x338,640x401,720x451,1080x676,1280x801,1299x813&from=bu&cs=1299x0" width="1000" />

Поскольку процессор у компьютера обычно один, а программ много, система постоянно переключается между ними - сначала поработает с браузером, потом с музыкой, потом с текстовым редактором. 
Это переключение происходит так быстро, что кажется, будто все программы работают одновременно. Это и есть **многозадачность**.

ОС ведет учет всех активных процессов через **таблицу процессов**, где хранится информация о состоянии каждого процесса, выделенных ему ресурсах и приоритете выполнения. 

<img src="https://profitserver.net/wp-content/uploads/2023/12/windows-monitoring-services_2_ru.jpg" width="1000" />

> ### Таблицу процессов в Windows Вы можете посмотреть в *"Диспетчере Задач"* или в *"Монитор Ресурсов"* 

Процессы могут находиться в различных состояниях: *выполнение, ожидание, готовность к выполнению*.
Переход между этими состояниями управляется **планировщиком процессов (Task scheduler)**, который решает, какой процесс получит доступ к процессору в следующий момент времени.

<img src="https://avatars.mds.yandex.net/i?id=99fcc45d8cb5cdd6583a349d8d96ae0a_l-5209452-images-thumbs&n=13" width="1000" />

Когда программам нужно обмениваться данными (например, когда ты копируешь текст из браузера в документ), они используют специальные "каналы связи", которые контролирует ОС.
Для координации работы нескольких процессов используются механизмы **межпроцессного взаимодействия** *(IPC - inter-process communication)*.
Процессы могут обмениваться данными через разделяемую память, очереди сообщений или другие каналы связи. 

<img width="1612" height="593" alt="image" src="https://github.com/user-attachments/assets/4815a513-1917-4f0e-a00c-c560c073cbd2" />


Особое внимание уделяется синхронизации процессов при работе с общими ресурсами, для чего применяются **мьютексы** и **семафоры**, предотвращающие конфликты доступа.

> - Критические секции предоставляют простой и легковесный способ синхронизации между потоками внутри одного процесса.
> - Mutexes (МЬЮТЕКСНЫЕ СЕМАФОРЫ) могут использоваться для синхронизации между разными процессами, а не только потоками внутри одного процесса.
> - Semaphores позволяют контролировать доступ к ресурсам, когда требуется счетчик.

> - Семафор помогает управлять тем, какие задачи могут работать одновременно. Он использует счетчик, который показывает, сколько задач могут работать в одно время. Если поток хочет что-то сделать, он может увеличить или уменьшить значение этого счетчика. Если цель — уменьшить счетчик, и он равен нулю, поток должен подождать, пока кто-то другой не освободит место, увеличив счетчик. Таким образом, семафоры помогают системам следить за тем, чтобы задачи не мешали друг другу и не создавали ошибки."

> ## Три выше перечисленные термины - методы синхронизации процессов. Для полного представления - welcome изучать winAPI. Лично я пока не буду.
> ## Кратко: здесь надо жёстко программировать, а я не умею :)
---

### УПРАВЛЕНИЕ ПАМЯТЬЮ: ОРГАНИЗАЦИЯ ДАННЫХ В ОЗУ

Оперативная память служит рабочим пространством для всех выполняемых процессов. 
Система управления памятью отвечает за распределение доступной памяти между конкурирующими процессами и обеспечение изоляции их данных.
Каждый процесс работает в своем **виртуальном адресном пространстве** (VAS), что создает иллюзию, будто он один использует всю доступную память.
Система следит, чтобы программы не мешали друг другу и не залезали на "чужую территорию".

<img src="https://cf5.ppt-online.org/files5/slide/k/KPU0LBAWNCxhoD5lOMgHdJGIjbszy8wrf76q4X/slide-7.jpg" width="1000" />

> - Каждый процесс в 32-разрядной версии Microsoft Windows имеет собственное виртуальное адресное пространство, которое позволяет обращаться к памяти объемом до 4 гигабайт.
> - Каждый процесс в 64-разрядной версии Windows имеет виртуальное адресное пространство размером 8 терабайт.
> - Все потоки процесса могут получить доступ к виртуальному адресно-пространству. Однако потоки не могут получить доступ к памяти, принадлежавшей другому процессу, который защищает процесс от повреждения другим процессом.

Основным механизмом управления памятью является **виртуальная память**, которая позволяет использовать пространство на жестком диске в качестве расширения оперативной памяти.

<img src="https://sysadminium.ru/wp-content/uploads/2021/08/image-3.png" width="1000" />

Она временно перемещает неиспользуемые данные из оперативной памяти на жесткий диск, освобождая место для более важных задач.
Когда эти данные снова понадобятся, система вернет их обратно в память.

Для эффективного использования памяти применяются различные алгоритмы **замещения страниц**, такие как **LRU** (вытеснение давно неиспользуемых страниц) и **FIFO** (вытеснение страниц в порядке их загрузки).
> - Это происходит в контексте виртуальной памяти, где виртуальное адресное пространство разделено на фиксированные блоки данных — страницы, а физическая память — на блоки того же размера — фреймы.

Есть 2 типа алгоритмов замещения страниц: 
- **Локальные**.  У каждого процесса есть свой лимит страниц в памяти — либо фиксированный, либо изменяемый. Если процессу не хватает страниц, система удаляет одну из его же страниц, не трогая страницы других процессов.
- **Глобальные** — в случае возникновения исключительной ситуации освобождают любую физическую страницу, независимо от того, какому процессу она принадлежала.

<img src="https://image3.slideserve.com/6487059/slide48-l.jpg" width="1000" />

Система также борется с **фрагментацией памяти** - ситуацией, когда свободная память разбита на множество небольших несмежных участков.
> ### Есть 2 типа фрагментации памяти:
> - **Внутренняя** . Возникает, когда внутри блока памяти остаётся неиспользуемое пространство. Например, если система выделяет блок памяти объёмом 64 КБ для хранения файла размером всего 40 КБ, то 24 КБ будут представлять собой внутреннюю фрагментацию. 
> - **Внешняя** . Когда нужно освободить память, система может удалить любую страницу — независимо от того, какому процессу она принадлежит.

---

### ФАЙЛОВЫЕ СИСТЕМЫ: ХРАНЕНИЕ ИНФОРМАЦИИ НА ДИСКАХ

Повторим, что **файловая система** организует данные на устройствах хранения в виде иерархической структуры файлов и каталогов. 
Она предоставляет удобный интерфейс для работы с данными, скрывая сложности физической организации хранения. 
Каждая файловая система имеет свою структуру метаданных, которая описывает расположение файлов, их атрибуты и свободное пространство.

При создании файла система находит свободные блоки на диске и записывает в них данные. 
Информация о файле (имя, размер, права доступа, расположение данных) сохраняется в специальных структурах - **inode** в UNIX-системах или **MFT записях** в NTFS. 

<img src="https://studfile.net/html/2706/1080/html_7pKJrv9dF9.ci5a/img-JUCLoq.png" width="500" />  <img src="https://andreyex.ru/wp-content/uploads/2019/03/Vse-chto-vam-nuzhno-znat-ob-inode-v-Linux_2.png" width="500" />

Для ускорения доступа к часто используемым данным система поддерживает **кэш файловой системы** в оперативной памяти.
> - Кэш файловой системы (дисковый кэш) работает как временное хранилище данных, которые часто используются в файловой системе. Это позволяет ускорить доступ к данным, содержащимся постоянно в основной памяти (диске).


Разные ОС используют разные системы организации - Windows обычно использует **NTFS**, а macOS - **APFS**.
Это как разные способы организации документов в офисе - кто-то использует папки одного цвета, кто-то другого, но суть одна: чтобы можно было быстро найти нужный документ.

<img src="https://www.phhsnews.com/img/how-to-2018/how-to-format-drive-with-apfs-file-system-on-macos-sierra-5.png" width="400" /> <img src="https://avatars.mds.yandex.net/i?id=fde9daf255d2e2e6cdc3e3ecc583d66e-4564518-images-thumbs&n=13" width="350" />

Когда ты сохраняешь файл, система находит свободное место на диске и записывает туда данные.
При этом она создает "ярлык" - записывает в специальный каталог информацию о файле: его название, где он лежит, какой размер и так далее.

<img width="572" height="617" alt="image" src="https://github.com/user-attachments/assets/df4d2556-6e31-4fb9-a245-1a94acf4ed82" />


Современные файловые системы используют **журналирование** для обеспечения целостности данных при сбоях. 
Перед выполнением операций изменения записываются в специальный журнал, и только после успешного завершения операции применяются к основной файловой системе.
Это позволяет восстановить данные в случае внезапного отключения питания.

<img src="https://present5.com/presentation/3/9475220_129773342.pdf-img/9475220_129773342.pdf-59.jpg" width="400" />

---

### ВЗАИМОСВЯЗЬ КОМПОНЕНТОВ СИСТЕМЫ

Все три компонента - управление процессами, памятью и файловыми системами - взаимосвязаны. 
При запуске программы *файловая система* считывает ее код с диска, *менеджер памяти* выделяет адресное пространство, а *диспетчер процессов* создает контекст выполнения и запускает программу.

<img width="1279" height="716" alt="image" src="https://github.com/user-attachments/assets/5872d1be-77b9-4094-ab8b-eb7cca5ed99d" />

Во время выполнения программы система постоянно координирует работу всех компонентов. Обращения к файлам приводят к загрузке данных в память, операции ввода-вывода переводят процессы в состояние ожидания, а нехватка памяти вызывает выгрузку страниц на диск. Эта сложная координация обеспечивает стабильную и эффективную работу всей системы.

<img src="https://otvet.imgsmail.ru/download/11b0a65b57cc0427e306ac49874b2535_i-16.jpg" width="1000" />

Оптимизация производительности требует сбалансированной настройки всех подсистем. Например, увеличение размера кэша файловой системы может улучшить скорость работы с диском, но уменьшить доступную память для процессов. Понимание взаимосвязей между этими компонентами позволяет принимать обоснованные решения при настройке и администрировании системы.

---

## Глоссарий

*   **Процесс** - экземпляр выполняемой программы, включающий код, данные и состояние выполнения
*   **PID** - уникальный числовой идентификатор процесса в операционной системе 
*   **POSIX** (Portable Operating System Interface) - набор стандартов, определяющих общий интерфейс для UNIX-подобных операционных систем.
*   **Таблица процессов** - структура данных в ядре ОС, содержащая информацию обо всех активных процессах
*   **Планировщик процессов** - компонент ОС, определяющий порядок выполнения процессов на процессоре
*   **Межпроцессное взаимодействие** - механизмы обмена данными и синхронизации между процессами
*   **Мьютекс** - примитив синхронизации, обеспечивающий эксклюзивный доступ к ресурсу
*   **Многозадачность** - способность компьютера работать с несколькими программами "одновременно" путем быстрого переключения между ними.
*   **Семафор** - механизм синхронизации, контролирующий доступ к ресурсу через счетчик
*   **Виртуальное адресное пространство** - изолированное пространство памяти, доступное процессу
*   **Виртуальная память** - технология, позволяющая использовать диск как расширение оперативной памяти
*   **LRU** (Least Recently Used) - алгоритм вытеснения страниц, удаляющий наиболее давно неиспользуемые страницы
*   **FIFO** (First In First Out) - алгоритм вытеснения страниц в порядке их загрузки в память
*   **Фрагментация памяти** - ситуация, когда свободная память разбита на небольшие несмежные участки
*   **Inode** (index node) - база данных в UNIX-системах, содержащая метаданные файла
*   **MFT** (Master File Table) - база данных, или как главная файловая таблица в NTFS, содержащая информацию о всех файлах на диске
*   **Кэш файловой системы** - область памяти для хранения часто используемых данных с диска
*   **Журналирование** - техника обеспечения целостности данных через ведение журнала операций
