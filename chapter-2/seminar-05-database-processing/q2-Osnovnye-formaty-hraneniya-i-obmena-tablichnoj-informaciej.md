Отлично! Я максимально дополнил и структурировал доклад, интегрировав вашу информацию и расширив ее новыми разделами, техническими деталями и практическими рекомендациями.

---

### **Доклад: Основные форматы хранения и обмена табличной информацией**

#### **Введение**

Табличная информация представляет собой структурированные данные, организованные в строки и столбцы, где каждая строка является записью, а каждый столбец — атрибутом или полем этой записи. Такие данные стали краеугольным камнем современной цифровой экономики и используются в бизнесе, науке, образовании, государственном управлении и многих других областях.

Для эффективного хранения и обмена такими данными были разработаны множество форматов файлов. Выбор правильного формата критически важен и зависит от целого ряда факторов: требуемая производительность, объем данных, необходимость в форматировании, совместимость между системами, безопасность и долгосрочная сохранность информации. Данный доклад детально рассматривает ключевые форматы, их официальные спецификации, внутреннее устройство, преимущества, недостатки и рекомендуемые сценарии использования.

---

### **1. Классификация форматов**

Для систематизации понимания форматы можно классифицировать по нескольким ключевым признакам:

*   **По структуре хранения:**
    *   **Текстовые (Human-readable):** Данные хранятся в виде простого текста, который может быть прочитан человеком (CSV, TSV, JSON, XML). Легки для отладки и редактирования.
    *   **Бинарные (Binary):** Данные хранятся в закодированном виде, оптимизированном для чтения компьютером (XLSX, Parquet, Avro, форматы баз данных). Обычно более компактны и производительны.

*   **По модели хранения данных:**
    *   **Построчные (Row-oriented):** Данные хранятся по строкам (CSV, JSON, Avro). Эффективны для операций записи и чтения полных записей (OLTP).
    *   **Колоночные (Column-oriented):** Данные хранятся по столбцам (Parquet, ORC). Эффективны для аналитических запросов, агрегаций и чтения подмножеств столбцов (OLAP).

*   **По поддержке схемы данных:**
    *   **Со схемой (Schema-on-Write):** Структура данных (типы полей, названия) строго определена заранее перед записью (XLSX, Parquet, Avro, реляционные БД). Гарантирует целостность данных.
    *   **Без схемы (Schema-on-Read):** Структура данных интерпретируется в момент чтения (CSV, JSON). Более гибки, но требуют дополнительных усилий по валидации.

*   **По целям использования:**
    *   **Универсальные/Нативные форматы офисных пакетов** (XLSX, ODS)
    *   **Форматы для веб и программирования** (JSON, XML)
    *   **Специализированные форматы для больших данных** (Parquet, Avro)
    *   **Форматы баз данных** (SQL-дампы, файлы СУБД)

---

### **2. Детальный обзор форматов**

#### **2.1. Текстовые форматы для простого обмена и обработки данных**

**CSV (Comma-Separated Values)**

**Официальный источник:** Де-факто стандартом является документ IETF **RFC 4180**.

**Описание и внутреннее устройство:** Это простой текстовый формат, где каждая строка файла соответствует строке таблицы. Значения полей разделены одним и тем же символом-разделителем (чаще всего запятой `,`). Если значение само содержит разделитель, кавычки или переносы строк, оно должно быть заключено в кавычки (`"`). Двойные кавычки внутри экранированных полей представляются двумя двойными кавычками подряд (`""`). Первая строка часто содержит заголовки столбцов.

**Преимущества:**
*   **Простота и универсальность:** Поддерживается всеми табличными процессорами, базами данных и языками программирования.
*   **Человекочитаемость:** Легко просматривать и редактировать в любом текстовом редакторе.
*   **Компактность:** Минимальные накладные расходы, файлы имеют малый размер.
*   **Легкость потоковой обработки:** Данные можно читать и обрабатывать построчно, не загружая весь файл в память.

**Недостатки:**
*   **Отсутствие типизации данных:** Все значения — строки. Числа, даты интерпретируются на этапе чтения, что может приводить к ошибкам.
*   **Отсутствие схемы:** Структура данных должна быть известна извне.
*   **Проблемы с экранированием:** Неоднозначности в парсинге могут приводить к ошибкам, особенно при нестандартных данных.
*   **Нет поддержки форматирования, формул, нескольких листов или кодировки метаданных.** Кодировка (UTF-8, Windows-1251) должна определяться отдельно.

**Пример CSV-файла:**
```csv
Name,Age,City
"Нигматуллин Илья Рафаильевич",?,"krasnoyarsk"
"хочу зачёт",17,"krasnoyarsk"
```

**TSV (Tab-Separated Values)**

**Официальный источник:** Спецификация поддерживается IANA как MIME-тип `text/tab-separated-values`.

**Описание:** Аналог CSV, но в качестве разделителя используется символ табуляции (`\t`). Это снижает вероятность конфликтов, так как табуляция реже встречается в реальных данных, чем запятая.

**Преимущества:**
*   Все преимущества CSV.
*   **Более надежное разделение:** Меньше шансов на ошибку парсинга из-за данных с запятыми.

**Недостатки:**
*   Менее удобочитаем для человека, так как табы могут отображаться по-разному в разных редакторах.
*   Остальные недостатки CSV, включая отсутствие типизации и схемы.

**Пример TSV-файла:**
```tsv
Name	Age	City	
Нигматуллин Илья Рафаильевич	?	krasnoyarsk	
Хочу зачёт	17	krasnoyarsk	
```

#### **2.2. Форматы для офисных пакетов с поддержкой форматирования**

**XLS (Microsoft Excel Binary File Format)**

**Официальный источник:** Исходная спецификация была проприетарной. Позже Microsoft опубликовала документацию в рамках политики открытых спецификаций (**[MS-XLS]: Excel Binary File Format (.xls) Structure**).

**Описание и внутреннее устройство:** Это сложный бинарный формат, оптимизированный для быстрой загрузки и выполнения вычислений в самой программе Excel. Данные хранятся в виде низкоуровневых бинарных записей (BIFF — Binary Interchange File Format). Формат включает в себя множество типов записей для хранения формул, форматирования, макросов VBA и т.д.

**Преимущества:**
*   **Высокая производительность в Excel:** Быстрая работа с очень большими файлами внутри родного приложения.
*   **Полная поддержка функциональности Excel:** Макросы, сложные формулы, элементы управления.

**Недостатки:**
*   **Закрытость и сложность:** Парсинг вне Microsoft Excel затруднен и требует специализированных, часто несовершенных библиотек.
*   **Риск безопасности:** Бинарные форматы исторически более уязвимы для эксплойтов.
*   **Плохая совместимость:** Не является кросс-платформенным стандартом.
*   **Не подходит для долгосрочного архивирования** из-за закрытости.

**XLSX (Office Open XML Spreadsheet)**

**Официальный источник:** Стандартизирован как ECMA-376 и ISO/IEC 29500.

**Описание и внутреннее устройство:** XLSX — это открытый формат на основе XML. Физически файл `.xlsx` является ZIP-архивом, содержащим набор папок и XML-файлов. Ключевые компоненты:
*   `xl/worksheets/sheet1.xml` — данные и формулы ячеек.
*   `xl/sharedStrings.xml` — общий пул строк для оптимизации (повторяющиеся строки хранятся один раз).
*   `xl/styles.xml` — определения стилей, шрифтов, цветов.
*   `xl/workbook.xml` — структура книги (список листов).
*   `[Content_Types].xml` — описание типов содержимого в архиве.

**Преимущества:**
*   **Открытый стандарт:** Обеспечивает высокую степень совместимости между различными программными продуктами (LibreOffice, Google Sheets).
*   **Богатая функциональность:** Полная поддержка формул, макросов (включая VBA, хотя они хранятся в отдельном бинарном потоке), форматирования, нескольких листов, графиков, сводных таблиц.
*   **Структурированность и доступность:** Данные можно извлечь с помощью стандартных инструментов работы с ZIP и XML.
*   **Более безопасен** по сравнению с XLS.

**Недостатки:**
*   **Избыточность:** Файлы могут быть велики из-за хранения метаданных о форматировании и XML-разметки, хотя сжатие ZIP частично нивелирует эту проблему.
*   **Производительность:** Может быть менее производительным для очень сложных вычислений по сравнению с бинарным XLS.
*   **Сложность парсинга:** Требует полной загрузки и обработки XML-структур, что ресурсоемко для простого извлечения данных.

**ODS (OpenDocument Spreadsheet)**

**Официальный источник:** Стандарт OASIS (ISO/IEC 26300).

**Описание:** Открытый формат, используемый в бесплатных офисных пакетах, таких как LibreOffice и Apache OpenOffice. Аналогичен XLSX по структуре — это также ZIP-архив, содержащий XML-файлы с данными, стилями и настройками.

**Преимущества:** Открытый, не привязанный к конкретному вендору стандарт.
**Недостатки:** Меньшая распространенность и иногда проблемы с совместимостью при сложном форматировании при открытии в Microsoft Excel.

#### **2.3. Форматы для веб-приложений и программирования**

**JSON (JavaScript Object Notation)**

**Официальный источник:** Стандарты ECMA-404 и RFC 8259.

**Описание и внутреннее устройство:** Легковесный текстовый формат для обмена структурированными данными. Хотя изначально не заточен исключительно под таблицы, может их представлять двумя основными способами:
1.  **Массив массивов:** `[ ["Имя", "Возраст"], ["Семён", 17], ["Нигматуллин Илья Рафаильевич", ?] ]`
2.  **Массив объектов (наиболее распространен):** `[ {"Имя": "Семён", "Возраст": 17}, {"Имя": "Нигматуллин Илья Рафаильевич", "Возраст": ?} ]`

**Преимущества:**
*   **Иерархичность:** Идеально подходит для представления сложных, вложенных и нерегулярных структур данных.
*   **Человекочитаемость и машинопарсимость.**
*   **Универсальная поддержка:** Является стандартом де-факто для веб-API (REST), конфигурационных файлов и NoSQL баз данных (MongoDB). Нативно поддерживается в JavaScript и легко парсится на других языках.

**Недостатки:**
*   **Избыточность:** Ключи (названия полей) повторяются для каждой записи, что увеличивает размер файла по сравнению с CSV.
*   **Отсутствие строгой схемы:** Проблема "Schema-on-Read", требующая валидации на стороне клиента.
*   **Нет поддержки бинарных данных** (без кодировки, например, Base64).
*   **Нет комментариев** в стандарте.

**Пример JSON-файла с вложенной структурой:**
```json
[
  {
    "id": 1,
    "name": "Нигматуллин Илья Рафаильевич",
    "contact": {
      "email": "inigmatullin@sfu-kras.ru",
      "phone": "+7 (391) 206-27-25"
    },
    "tags": ["Самый_крутой"]
  },
  {
    "id": 2,
    "name": "Семён",
    "contact": {
      "email": "semenyarsk@gmail.com"
    },
    "tags": ["бедолага"]
  }
]
```

**XML (eXtensible Markup Language)**

**Официальный источник:** Стандарт W3C.

**Описание:** Более строгий и сложный, чем JSON, формат разметки. Для представления таблиц может использоваться произвольная XML-структура или специализированные стандарты, например, SpreadsheetML (часть формата XLSX).

**Преимущества:**
*   **Строгость и мощная схема:** Возможность определения сложных схем данных с помощью XSD (XML Schema Definition) и их строгой валидации.
*   **Поддержка пространств имен (Namespaces).**
*   **Поддержка комментариев и обработки инструкций.**

**Недостатки:**
*   **Высокая избыточность (Verbose):** Большой объем файла из-за закрывающих тегов.
*   **Сложность парсинга:** Требует более ресурсоемких DOM- или SAX-парсеров.
*   **Менее читаем для человека** по сравнению с JSON.

**Пример XML-файла:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<employees>
  <employee>
    <id>1</id>
    <name>Нигматуллин Илья Рафаильевич</name>
    <age>?</age>
    <city>krasnoyarsk</city>
  </employee>
  <employee>
    <id>2</id>
    <name>Семён</name>
    <age>17</age>
    <city>krasnoyarsk</city>
  </employee>
</employees>
```

#### **2.4. Специализированные и высокопроизводительные форматы**

**Apache Parquet**

**Официальный источник:** Спецификация проекта Apache Parquet.

**Описание и внутреннее устройство:** Колоночный формат хранения, оптимизированный для обработки больших данных в распределенных системах (Hadoop, Spark). Данные разбиваются на строки (row groups), внутри которых они хранятся по столбцам (column chunks). Для каждого столбца создаются метаданные: минимальное/максимальное значение, счетчики и т.д. Данные кодируются (RLE, Dictionary Encoding) и сжимаются (Snappy, GZIP).

**Принцип работы:** При запросе "показать среднюю зарплату" системе не нужно читать все строки (как в CSV). Она читает только столбец "Зарплата", что резко снижает дисковый I/O.

**Преимущества:**
*   **Эффективное сжатие:** Алгоритмы сжатия работают намного лучше с однотипными данными в столбце.
*   **Высокая производительность запросов:** Аналитические запросы, обращающиеся к нескольким столбцам, выполняются в разы быстрее.
*   **Экономия ввода-вывода (I/O).**
*   **Поддержка сложных вложенных структур.**
*   **Predicate Pushdown:** Система фильтрации может отбрасывать целые группы строк на основе метаданных столбца, даже не читая их.

**Недостатки:**
*   **Нечитаем для человека.** Требует специализированных инструментов для просмотра.
*   **Не подходит для операций записи/обновления отдельных записей.** Оптимизирован для записи один раз и чтения много раз (Write-once, Read-many).
*   **Сложность:** Требует использования специализированных библиотек (например, `pyarrow` в Python).

**Apache Avro**

**Официальный источник:** Спецификация проекта Apache Avro.

**Описание:** Строчный (row-oriented) бинарный формат. Его ключевая особенность — схема, записанная в формате JSON, которая всегда хранится вместе с данными (обычно в заголовке файла). Это позволяет осуществлять сериализацию и десериализацию без генерации кода и обеспечивает эволюцию схемы.

**Преимущества:**
*   **Компактность:** Эффективная бинарная сериализация.
*   **Эволюция схемы:** Возможность добавлять новые поля и удалять старые при сохранении совместимости (forward/backward compatibility).
*   **Быстрая сериализация/десериализация.**
*   **Разделение схемы и данных:** Схема может передаваться отдельно, что еще больше уменьшает размер передаваемых данных.

**Недостатки:**
*   Менее эффективен для аналитических запросов, требующих только подмножество столбцов, по сравнению с колоночными форматами.

**Сценарии использования:** Сериализация сообщений в потоковой обработке данных (Apache Kafka), хранение данных в Hadoop HDFS.

#### **2.5. Форматы баз данных**

*   **Описание:** Реляционные СУБД (MySQL, PostgreSQL, SQLite) хранят табличные данные в своих собственных, высокооптимизированных бинарных форматах. Для обмена данными между системами часто используются **SQL-дампы** — текстовые файлы, содержащие последовательность SQL-команд (CREATE TABLE, INSERT) для полного восстановления структуры и данных.

*   **SQLite как формат файла:** Особняком стоит SQLite, где вся база данных хранится в одном кроссплатформенном бинарном файле. Этот файл является де-факто форматом хранения табличной информации внутри самого приложения.

*   **Особенности:**
    *   **ACID-транзакции:** Гарантии целостности данных.
    *   **Индексы:** Обеспечивают высокую скорость поиска.
    *   **Язык запросов SQL:** Мощный и стандартизированный инструмент для манипуляции данными.
    *   **Строгая схема.**

*   **Сценарии использования:** Хранение операционных данных (OLTP), backend веб-приложений, встроенные базы данных для приложений (SQLite).

---

### **3. Сравнительная таблица**

| Формат | Основа / Модель | Стандарт | Читаемость | Схема | Поддержка формул/форматирования | Сжатие | Основное применение |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **CSV** | Текст / Построчная | **RFC 4180** | **Высокая** | Нет | Нет | Низкое | Универсальный обмен, импорт/экспорт |
| **TSV** | Текст / Построчная | **IANA** | **Высокая** | Нет | Нет | Низкое | Анализ данных, биоинформатика |
| **XLS** | Бинарный / Построчная | Проприетарный | Нет | Есть | **Полная** | Среднее | Устаревшие версии Excel |
| **XLSX** | XML/ZIP / Построчная | **ISO/IEC 29500** | Нет (структур.) | Есть | **Полная** | Среднее (ZIP) | Современные офисные приложения |
| **JSON** | Текст / Построчная | **RFC 8259** | **Высокая** | Нет\* | Нет | Низкое | Веб-API, конфиги, NoSQL |
| **XML** | Текст / Иерархическая | **W3C** | Средняя | Есть (XSD) | Нет | Низкое | Корпоративные системы, SOAP |
| **Parquet** | Бинарный / **Колоночная** | **Apache** | Нет | **Есть** | Нет | **Очень высокое** | Аналитика Big Data, Data Lakes |
| **Avro** | Бинарный / Построчная | **Apache** | Нет | **Есть** | Нет | Высокое | Потоковая обработка (Kafka) |
| **SQL-дамп** | Текст / Построчная | SQL стандарт | Средняя | **Есть** | Нет | Низкое | Резервное копирование, миграции БД |
| **SQLite** | Бинарный / Построчная | **Публичная** | Нет | **Есть** | Нет | Зависит | Встроенные БД, локальное хранение |


---

### **4. Практические рекомендации по выбору формата**

*   **Для максимальной совместимости и простоты:** Используйте **CSV** или **TSV**. Идеально для экспорта данных из одной системы и импорта в другую.
*   **Для бизнес-отчетов с форматированием, графиками и формулами:** Используйте **XLSX**. Это отраслевой стандарт.
*   **Для веб-приложений и API:** Используйте **JSON**. Это язык общения между фронтендом и бэкендом.
*   **Для долгосрочного архивирования структурированных данных:** Рассмотрите **XML** со схемой XSD или **Parquet**. Они обеспечивают самодокументируемость и целостность.
*   **Для аналитических пайплайнов и больших данных:** Используйте **Parquet**. Это значительно ускорит обработку и сэкономит место.
*   **Для потоковой передачи данных и сериализации сообщений:** Используйте **Avro**. Он обеспечивает компактность и эволюцию схемы.
*   **Для встроенного хранения в приложениях:** Используйте **SQLite**. Это надежно, производительно и не требует отдельного сервера БД.
*   **Избегайте проприетарных бинарных форматов (старые версии .xls) для долгосрочного хранения** из-за риска потери совместимости.

---

### **Заключение**

Выбор оптимального формата для хранения и обмена табличной информацией — это стратегическое решение, оказывающее прямое влияние на производительность, стоимость и гибкость работы с данными.

*   **CSV/TSV** остаются "рабочими лошадками" для простого и универсального обмена.
*   **XLSX** доминирует в мире бизнеса, где данные неотделимы от их визуального представления.
*   **JSON** стал "лингва франка" веб-разработки и обмена иерархическими данными.
*   **Parquet** и **Avro** являются специализированными "суперкарами" для мира больших данных, решающими задачи масштабирования и производительности.
*   **Форматы баз данных** обеспечивают надежность, целостность и мощь реляционной модели.

Таким образом, не существует "универсально лучшего" формата. Существует **наиболее подходящий инструмент для конкретной задачи**. Глубокое понимание внутреннего устройства, сильных и слабых сторон каждого формата позволяет  делать осознанный выбор, который оптимизирует рабочие процессы и обеспечивает долгосрочную ценность данных.