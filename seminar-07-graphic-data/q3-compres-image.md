# Вопрос 3: Популярные форматы графических файлов и способы сжатия изображений

## Основные понятия

**Формат графического файла** — способ записи графических данных. Любой визуальный элемент на сайте, в приложении или документе представляет собой файл определенного формата.

**Цели сжатия графических файлов:**
- Экономия места (на диске, в телефоне, на сервере)
- Ускорение передачи (загрузка на сайт, отправка по почте)

## Методы сжатия изображений

### Сжатие без потерь (Lossless)

Метод уменьшения размера файла с полным восстановлением исходных данных при распаковке. Ни один пиксель, ни один бит информации не теряется.

**RLE (Run-Length Encoding) — Кодирование длин серий**
Самый простой метод сжатия без потерь. Алгоритм сканирует данные и находит последовательности одинаковых элементов. Вместо хранения каждого элемента сохраняет пару чисел: (значение, количество повторений). Эффективен для изображений с большими одноцветными областями. Используется в простых вариантах формата BMP и в факсимильной связи.

**LZW (Lempel-Ziv-Welch) — Алгоритм Лемпеля-Зива-Уэлча**
Более сложный метод, который строит словарь повторяющихся последовательностей данных. Алгоритм динамически создает словарь, куда заносит все встречающиеся паттерны. Когда последовательность встречается снова, она заменяется в файле коротким кодом из словаря. При распаковке программа использует тот же словарь для восстановления данных. Широко применяется в форматах GIF и TIFF.

**DEFLATE**
Комбинированный алгоритм, объединяющий LZ77 и кодирование Хаффмана. На первом этапе LZ77 алгоритм ищет повторяющиеся строки и заменяет их ссылками на предыдущие вхождения. На этапе Хаффмана полученные данные сжимаются еще раз — часто встречающимся символам присваиваются короткие битовые коды, редким — длинные. Является основой формата PNG и знаменитых ZIP-архивов.

### Сжатие с потерями (Lossy)

Метод уменьшения размера файла за счет безвозвратного удаления части данных. Алгоритм основан на особенностях человеческого восприятия: он отбрасывает информацию, которую наш глаз и мозг с большой вероятностью не заметят.

**JPEG (наиболее распространенный)**
Многоэтапный алгоритм сжатия, ставший стандартом для фотографических изображений. Процесс включает преобразование цветового пространства из RGB в YCbCr, прореживание цветности, дискретное косинусное преобразование (DCT), квантование и энтропийное кодирование. Ключевой этап — квантование, где происходит основное сжатие за счет удаления малозаметных деталей.

**Вейвлет-преобразование**
Используется в формате JPEG2000, обеспечивает лучшее качество при высоких степенях сжатия по сравнению с традиционным JPEG. Вейвлет-преобразование лучше сохраняет резкие границы и текстуры изображения.

**Фрактальное сжатие**
Основано на поиске самоподобных участков изображения. Алгоритм ищет фрактальные закономерности в изображении и записывает их в виде математических формул, что позволяет достигать высоких коэффициентов сжатия.

## Артефакты сжатия с потерями

При сильном сжатии потери становятся видимыми в виде различных артефактов:

**Блочность** — появление видимых квадратов 8×8 пикселей, границы между блоками становятся заметными из-за разницы в их усредненных тонах.

**Размытие** — исчезновение мелких деталей и текстур, так как высокочастотные коэффициенты были обнулены в процессе квантования.

**Муар** — появление несуществующих узоров на областях с повторяющейся мелкой деталью, например, на ткани в клетку или частых решетчатых структурах.

**Артефакты бахромы** — появление неприятных контуров или "ореолов" вокруг контрастных границ объектов.

## Форматы графических файлов

### Векторные форматы

**SVG (Scalable Vector Graphics)**
Открытый стандарт для веб-графики, использующий сжатие без потерь через алгоритм GZIP. Формат основан на XML и описывает изображение с помощью математических формул, кривых и примитивов. Ключевое преимущество — бесконечное масштабирование без потери качества. Поддерживает анимацию, интерактивность и прозрачность. Идеален для логотипов, иконок, инфографики и технических чертежей.

**PDF (Portable Document Format)**
Универсальный кроссплатформенный формат, применяющий гибридное сжатие: JPEG для растровых элементов и ZIP для векторных. Сохраняет точную верстку документа независимо от устройства просмотра. Широко используется в полиграфии, документации и электронных публикациях.

**Специализированные редакторские форматы**
AI (Adobe Illustrator) и CDR (CorelDRAW) — проприетарные форматы, использующие внутреннее сжатие без потерь. Сохраняют все рабочие элементы проектов: слои, эффекты, шрифты, направляющие. Предназначены для профессиональной работы с векторной графикой.

### Растровые форматы

**JPEG (Joint Photographic Experts Group)**
Самый распространенный формат для фотографических изображений. Использует сжатие с потерями через дискретное косинусное преобразование и квантование. Обеспечивает малый размер файла ценой необратимых потерь деталей, что особенно заметно при сильном сжатии. Широко используется в цифровых камерах, веб-графике и социальных сетях.

**PNG (Portable Network Graphics)**
Формат, использующий алгоритм DEFLATE для сжатия без потерь. Поддерживает полноценную прозрачность (альфа-канал), палитру до 48-бит и цветовые профили. Идеален для графики с четкими границами, логотипов, скриншотов и изображений с текстом. Для фотографий эффективность сжатия значительно ниже, чем у JPEG.

**GIF (Graphics Interchange Format)**
Один из старейших форматов, использующий алгоритм LZW. Ограничен палитрой 256 цветов, поддерживает анимацию и простую прозрачность. Эффективен для графики с большими одноцветными областями, простой анимации и графических элементов с ограниченным количеством цветов.

**TIFF (Tagged Image File Format)**
Гибкий растровый формат, поддерживающий как сжатие без потерь, так и с потерями. Сохраняет глубину цветов, метаданные и может содержать несколько слоев изображения. Широко используется в полиграфии, сканировании и профессиональной фотографии благодаря возможности сохранения максимального качества.

**RAW**
"Сырой" формат, содержащий необработанные данные с матрицы цифровой камеры. Сохраняет максимально возможное качество изображения и богатые метаданные. Требует последующей обработки в специальных программах. Используется профессиональными фотографами для получения наилучшего качества.

**PSD (Photoshop Document)**
Нативный формат Adobe Photoshop, сохраняющий все элементы редактирования: слои, маски, эффекты, корректирующие слои и цветовые профили. Использует сжатие без потерь. Незаменим для хранения рабочих проектов и многоэтапного редактирования.

## Новые форматы изображений

**WebP**
Современный формат от Google, сочетающий преимущества JPEG и PNG. Поддерживает как сжатие с потерями (более эффективное, чем JPEG), так и без потерь (лучше PNG), а также анимацию и прозрачность. Обеспечивает уменьшение "веса" изображения при сохранении высокого качества, что ускоряет загрузку веб-страниц.

**HEIF/HEIC**
Формат на основе видео-кодека HEVC (H.265), обеспечивающий лучшее качество при том же размере файла, что и JPEG. Может хранить последовательности изображений, глубину карты и альфа-канал. Широко используется в экосистеме Apple. Поддерживает до десяти уровней сжатия для оптимизации загрузки.

**AVIF**
Формат на основе кодека AV1, демонстрирующий наилучшую эффективность сжатия среди современных форматов. Поддерживает HDR, прозрачность и анимацию при минимальном размере файла. Постепенно набирает поддержку в браузерах и приложениях.

## Рекомендации по выбору форматов

| Задача | Рекомендуемые форматы | Примечания |
|--------|----------------------|------------|
| **Фотография для сайта** | WebP, AVIF, JPEG | WebP и AVIF обеспечивают лучшее качество при меньшем размере |
| **Логотип с прозрачностью** | SVG, PNG, WebP | SVG для векторных логотипов, PNG/WebP для растровых |
| **Простая анимация** | GIF, WebP, AVIF | GIF для совместимости, WebP/AVIF для качества |
| **Полиграфия** | TIFF, PDF | Сохранение максимального качества для печати |
| **Сканирование документов** | TIFF, PNG | Без потерь для важных документов |
| **Редактирование фотографий** | RAW, PSD | Максимальное качество и сохранение слоев |
| **Векторная графика** | SVG, AI, CDR | SVG для веба, AI/CDR для редактирования |
| **Скриншоты и интерфейсы** | PNG, WebP | Четкие границы и прозрачность |
| **Иконки для сайта** | SVG, PNG | SVG для масштабируемости |
| **Архивация изображений** | TIFF, PNG | Сохранение без потерь для долгосрочного хранения |

## Заключение

Выбор графического формата и метода сжатия — это всегда поиск оптимального баланса между качеством изображения, размером файла и конкретной задачей. Растровые форматы идеальны для фотографий и сложных изображений, в то время как векторные форматы незаменимы для логотипов, иконок и графики с четкими границами.
